<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Imgur Tray</title>

    <link rel="stylesheet" href="./css/main.css">

    <script>require('./index')</script>
  </head>

  <body>

    <main class="main">
      <p>Upload an image</p>
      <form id="upload">
        <input type="file" id="image" placeholder="Upload...">
        <input type="submit" value="Submit">
      </form>
    </main>

    <script>

      let form = document.getElementById('upload')
      let file = document.getElementById('image')

      file.addEventListener('change', function(e) {
        let files = e.target.files, file, len, i

        for (i = 0, len = files.length; i < len; i++) {
          file = files[i]

          if (file.type.match(/image.*/)) {
            uploadFile(file)
          }
        }
      }, false)

      function uploadFile(file) {
        let xhttp = new XMLHttpRequest()
        let fd = new FormData()
        let self = this

        fd.append('image', file)

        xhttp.open('POST', 'https://api.imgur.com/3/image')
        xhttp.setRequestHeader('Authorization', 'Client-ID e57becf7e161301')
        xhttp.onreadystatechange = function () {
          if (xhttp.status === 200 && xhttp.readyState === 4) {
            let res = JSON.parse(xhttp.responseText)
            console.log('success!', res)
          }
        }
        xhttp.send(fd)
      }

    </script>

  </body>
</html>
